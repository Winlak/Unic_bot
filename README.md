# Unic Video Bot

Telegram-бот на aiogram 3, который локально уникализирует вертикальные видео по заданному пайплайну.

## Требования
- Python 3.10+
- Установленный FFmpeg CLI (должен быть доступен как `ffmpeg`)

## Настройка
1. Создай виртуальное окружение и установи зависимости:
   ```bash
   python3 -m venv .venv
   source .venv/bin/activate
   pip install -U pip wheel
   pip install -r requirements.txt
   ```
2. Отредактируй `config.py`:
   - `BOT_TOKEN` — токен Telegram-бота
   - `OWNER_TELEGRAM_ID` — твой числовой ID
   - при необходимости скорректируй диапазоны эффектов и другие параметры.
3. Убедись, что FFmpeg установлен локально и поддерживает фильтры `shuffleframes`, `vignette`, `noise`, `asetrate`.

## Запуск
```bash
python bot.py
```
Бот работает в режиме polling и хранит временные файлы в `tmp/` (очищаются после обработки).

## Docker
1. Перед сборкой проверь `config.py` (заполни `BOT_TOKEN` и `OWNER_TELEGRAM_ID`).
2. Собери образ:
   ```bash
   docker build -t unicbot .
   ```
3. Запусти контейнер:
   ```bash
   docker run --rm --name unicbot \\
     -v $(pwd)/tmp:/app/tmp \\
     unicbot
   ```
4. Или используй docker compose:
   ```bash
   docker compose up --build
   ```

## Поведение
1. `/start` выводит короткую инструкцию.
2. Бот принимает либо видеофайл (телеграм-видео или документ `mime_type=video`), либо ссылку на YouTube Shorts/ролик. Любой другой контент отклоняется.
3. После загрузки или скачивания файла бот предлагает выбрать 1–5 вариантов и нажать «Старт».
4. Для каждого варианта генерируются независимые параметры:
   - Zoom + crop + возврат к исходному разрешению (без изменения пропорций)
   - Яркость и насыщенность в допустимых диапазонах
   - Слой шума/зерна
   - Pitch shift аудио ±1.5% с компенсацией темпа
   - Очистка метаданных
5. Все результаты отправляются в чат вместе с отчётом по параметрам. После успешной отправки исходный и выходные файлы удаляются. Для ссылок видео предварительно скачивается через `yt-dlp`.

## Ошибки и ретраи
- Ошибки FFmpeg возвращаются в чат с указанием варианта.
- Отправка в Telegram повторяется до 3 раз (учитывается `RetryAfter`).
- Telegram ограничивает скачивание ботами примерно 20 МБ при работе через официальный облачный API (это ограничение сервиса).

## Дополнительные фичи, реализованные по согласованию
1. Audio Pitch Micro-Shift — микросмещение тональности ±1.5% с сохранением длительности.
2. (удалено) Dynamic Vignette — отключено для исключения мерцания.
3. (удалено) Frame Dup Shuffle — отключено, чтобы не менять порядок кадров.
